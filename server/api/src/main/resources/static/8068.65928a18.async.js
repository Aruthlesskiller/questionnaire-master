(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[8068],{68068:function(ae,X,u){"use strict";u.d(X,{O:function(){return re},Z:function(){return $e}});var Q=u(9761),M=u(67294),G=u(3044),K=u(86052),Y=u(48187),k=u(91220),q=u(93224),P=u(39428),T=u(83279),A=u(3182),V=u(11849),ee=u(94657),se=u(69610),ue=u(54941),_=u(3980),j=u(64031),y=u(54531);function le(l,t){}var O=u(40807),oe=["visible"],de=function(){function l(t){var r=this,i;(0,se.Z)(this,l),this.props=void 0,this.progress=0,this.form=void 0,this.pagination={current:1,pageSize:1,currentIndex:0,paginationNodes:[]},this.unmount=!1,this.notNoneInQuestionGroup=[],this.answerSheet=[],this.answerSheetVisible=!1,this.reviewAnswer={},this.autoNextPage=void 0,this.compute=void 0,this.hiddenOption={},this.visibleId=void 0,this.lazy=!1,this.preloadId=void 0;var n=t.initialValues,e=t.readOnly,a=t.fieldPermission,s=t.theme,o=t.schema,f=t.mode,v=t.onePageOneQuestion,m=v===void 0?!1:v,p=t.paginationVisible;this.props=t,this.lazy=!!t.onLazyLoad,this.initPagination(o,p,m);var h=(0,j.Np)({initialValues:n,readOnly:e,validateFirst:!0,pattern:t.pattern,effects:function(c){(0,j.dQ)(function(){if(a){var d=[],b=[];Object.entries(a).forEach(function($){var x=(0,ee.Z)($,2),Z=x[0],F=x[1];F===0?d.push(Z):F===1&&b.push(Z)}),d.length>0&&h.setFieldState("*(".concat(d.join(","),")"),function($){return $.display="none"}),b.length>0&&h.setFieldState("*(".concat(b.join(","),")"),function($){return $.pattern="readPretty"})}r.handleFormValuesChange(),r.highlightJs(),r.setVisible(0)}),(0,j.pO)(function(d){r.handleFormValuesChange()}),(0,j.Zj)("*",function(d,b){r.handleFieldValueChange(d,b)}),le(o,c)}});this.form=h,this.answerSheet=((i=this.lazy?o.children:(0,O.Xn)(o))===null||i===void 0?void 0:i.filter(function(g){var c,d;return r.lazy||(0,O.a1)(g.type)&&((c=g.attribute)===null||c===void 0?void 0:c.display)!=="hidden"&&((d=g.attribute)===null||d===void 0?void 0:d.examAnswerMode)!=="none"}).map(function(g){var c,d=(c=t.initialQuestionScore)===null||c===void 0?void 0:c[g.id];return{finished:!1,id:g.id,marked:!1,display:r.lazy?"hidden":"visible",favorite:!!t.wrongMode,isCorrect:d===void 0?void 0:d>0}}))||[],s==="antd"&&f==="exam"&&(this.answerSheetVisible=!0),this.autoNextPage=0,t.exerciseMode&&t.onePageOneQuestion&&(this.autoNextPage=1),this.makeObservable(),this.props.correctAnswerVisible&&n&&(0,O.Xn)(o).forEach(function(g){r.computeReviewAnswer(g,n[g.id]).then(function(c){c&&(r.reviewAnswer[g.id].visible=!0)})}),this.compute=fe(function(){r.unmount||(r.lazy||r.reOrder(),r.computePagination())},10)}return(0,ue.Z)(l,[{key:"makeObservable",value:function(){(0,y.Ou)(this,{progress:y.LO.ref,pagination:y.LO,form:y.LO.ref,props:y.LO.shallow,answerSheet:y.LO,answerSheetVisible:y.LO.ref,reviewAnswer:y.LO,notNoneInQuestionGroup:y.LO,schema:y.LO.computed,autoNextPage:y.LO.ref,hiddenOption:y.LO.shallow,exerciseMode:y.LO.computed,lazy:y.LO.ref,visibleId:y.LO.ref,computeProgress:y.aD,validate:y.aD,handlePrev:y.aD,handleNext:y.aD,submit:y.aD,handleFormValuesChange:y.aD,changePageIndex:y.aD,handleFieldValueChange:y.aD,computeReviewAnswer:y.aD,reOrder:y.aD})}},{key:"schema",get:function(){return(0,y.ZN)(this.props.schema)}},{key:"questionsGroupByPagination",get:function(){return this.pagination.paginationNodes}},{key:"exerciseMode",get:function(){return this.props.exerciseMode||!1}},{key:"initPagination",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i?this.pagination.paginationNodes=(0,O._T)(r,n,this.lazy):this.pagination.paginationNodes=[r.children],this.pagination.pageSize=this.pagination.paginationNodes.length}},{key:"computePagination",value:function(){if(this.props.paginationVisible===!1)return;var r=this.form.fields,i=this.pagination,n=i.paginationNodes,e=i.currentIndex;if(this.lazy){this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{pageSize:n.length,currentIndex:e,current:e+1});return}function a(m){return n[m].every(function(p){var h,g=((h=r[p.id])===null||h===void 0?void 0:h.data)||[];return g.some(function(c){return c==="self_display"||c.startsWith("rule_")})})}for(var s=0,o=0,f=0;f<n.length;f++){var v=n[f];if(v.some(function(m){var p,h=((p=r[m.id])===null||p===void 0?void 0:p.data)||[];return h.length===0}))o++,s++;else{if(a(f))continue;o++,f<=e&&s++}}this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{current:s,pageSize:o,currentIndex:e})}},{key:"highlightJs",value:function(){document.querySelectorAll(".ql-syntax").forEach(function(r){})}},{key:"validate",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(n){var e,a;return(0,P.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=((e=this.questionsGroupByPagination[n])===null||e===void 0?void 0:e.reduce(function(f,v){return f.push.apply(f,(0,T.Z)((0,O.Xn)(v))),f},[]))||[],a.length!==0){o.next=3;break}return o.abrupt("return",!0);case 3:return o.abrupt("return",this.form.validate("*(".concat(a.map(function(f){return f.id}).join(","),")")));case 4:case"end":return o.stop()}},i,this)}));function r(i){return t.apply(this,arguments)}return r}()},{key:"setVisible",value:function(r){var i=this;if(this.props.paginationVisible===!1)return!1;var n=this.pagination,e=n.currentIndex,a=n.paginationNodes,s=this.form.fields,o=r===void 0?e:r;function f(x){return a[x].every(function(Z){var F,z=((F=s[Z.id])===null||F===void 0?void 0:F.data)||[];return z.some(function(B){return B==="self_display"||B.startsWith("rule_")})})}if(r!==void 0){if(r===e+1){var v=f(r);if(v){this.pagination.currentIndex=e+1,this.setVisible(r+1);return}}else if(r===e-1){var m=f(r);if(m){this.pagination.currentIndex=e-1,this.setVisible(r-1);return}}}if(this.lazy){var p;this.visibleId&&(s[this.visibleId].display="hidden");var h=a[o];h==null||h.forEach(function(x){s[x.id].display="visible",i.visibleId=x.id});var g=(p=a[o+1])===null||p===void 0?void 0:p[0].id;if(g){var c,d;(c=this.form)===null||c===void 0||(d=c.query(g).take())===null||d===void 0||d.setComponentProps({preload:!0})}this.compute()}else for(var b=0;b<a.length;b++){var $=a[b];b===o?$==null||$.forEach(function(x){var Z=s[x.id].data;s[x.id].data=Z.filter(function(F){return F!=="hidden"})}):$.forEach(function(x){var Z=s[x.id].data;Z.includes("hidden")||(s[x.id].data=[].concat((0,T.Z)(Z),["hidden"]))})}this.pagination.currentIndex=o}},{key:"handlePrev",value:function(){var r=this.pagination.currentIndex;this.setVisible(r-1)}},{key:"handleNext",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(n){var e;return(0,P.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return e=this.pagination.currentIndex,s.prev=1,s.next=4,this.validate(e);case 4:this.setVisible(e+1),setTimeout(function(){return window.scroll({top:0})},10),s.next=11;break;case 8:s.prev=8,s.t0=s.catch(1),console.log(s.t0);case 11:case"end":return s.stop()}},i,this,[[1,8]])}));function r(i){return t.apply(this,arguments)}return r}()},{key:"getPageIndexByQid",value:function(r){return this.lazy?this.questionsGroupByPagination.findIndex(function(i){return i[0].id===r}):this.questionsGroupByPagination.findIndex(function(i){return!!(i.reduce(function(n,e){return n.push.apply(n,(0,T.Z)((0,O.Xn)(e))),n},[])||[]).find(function(n){return n.id===r})})}},{key:"changePageIndex",value:function(r){var i=this.getPageIndexByQid(r);i!==-1&&(this.setVisible(i),(0,O.lA)(r,this.props.progressBar?-25:0))}},{key:"handleFormValuesChange",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(){return(0,P.Z)().wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.computeProgress(),this.props.onChange&&this.props.onChange(this.form.values,this.progress);case 2:case"end":return e.stop()}},i,this)}));function r(){return t.apply(this,arguments)}return r}()},{key:"handleFieldValueChange",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(n,e){var a,s,o;return(0,P.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:o=n.path.toString(),(a=(s=this.props).onFieldChange)===null||a===void 0||a.call(s,o,(0,y.ZN)(n.value)),this.props.exerciseMode&&this.computeReviewAnswer(n.componentProps.schema,n.value);case 3:case"end":return v.stop()}},i,this)}));function r(i,n){return t.apply(this,arguments)}return r}()},{key:"computeReviewAnswer",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(n,e){var a,s,o,f,v,m,p,h;return(0,P.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(a=!1,this.props.mode!=="exam"){c.next=12;break}if(o=this.reviewAnswer[n.id]||{},f=n.type,["FillBlank","MultipleBlank","HorzBlank","Radio","Checkbox","Judge"].includes(n.type)){c.next=6;break}return c.abrupt("return");case 6:if((f==="Radio"||f==="Judge")&&(o.visible=!0),(s=n.attribute)!==null&&s!==void 0&&s.examAnswerMode&&["selectAll","selectCorrect","onlyOne","select"].includes(n.attribute.examAnswerMode)){c.next=9;break}return c.abrupt("return");case 9:a=!0,this.reviewAnswer[n.id]=n.children.reduce(function(d,b){var $,x=!!(($=b.attribute)!==null&&$!==void 0&&$.examCorrectAnswer);if(f==="FillBlank"||f==="MultipleBlank"||f==="Textarea"||f==="HorzBlank"){var Z,F,z=(Z=b.attribute)===null||Z===void 0?void 0:Z.examMatchRule,B=e==null?void 0:e[b.id],J=(F=b.attribute)===null||F===void 0?void 0:F.examCorrectAnswer;!B||!J?x=!1:z==="contain"&&B.includes(J.trim())||B===J?x=!0:x=!1}return d[b.id]={selected:!!(e!=null&&e.hasOwnProperty(b.id)),isCorrect:x},d},{visible:!!(o!=null&&o.visible)}),this.autoNextPage===1&&(v=this.reviewAnswer[n.id],m=v.visible,p=(0,q.Z)(v,oe),h=Object.values(p).filter(function(d){return d.selected&&d.isCorrect}).length===1,h&&(f==="Radio"||f==="Judge")&&this.handleNext());case 12:return c.abrupt("return",a);case 13:case"end":return c.stop()}},i,this)}));function r(i,n){return t.apply(this,arguments)}return r}()},{key:"computeProgress",value:function(){var r=this;if(!!this.props.progressBar){var i=0,n=0;if(this.lazy){var e;i=((e=this.schema.children)===null||e===void 0?void 0:e.length)||1,n=Object.keys(this.form.values).length,this.progress=n/i;return}this.form.query("*").forEach(function(a){var s=r.answerSheet.find(function(o){return o.id===a.path.toString()});a.displayName==="Field"&&!a.path.toString().startsWith("_")&&(s&&(s.display=a.display),a.data.filter(function(o){return o!=="hidden"}).length===0&&i++,!(0,O.xb)(a.value)&&a.componentProps.schema.attribute.display!=="hidden"?(n++,s&&(s.finished=!0)):s&&(s.finished=!1))}),this.progress=n/i}}},{key:"reOrder",value:function(){var r,i=this,n=1;(r=this.schema.children)===null||r===void 0||r.filter(function(e){var a;return(!(0,O.nj)(e.type)||e.type==="QuestionSet")&&((a=e.attribute)===null||a===void 0?void 0:a.examAnswerMode)!=="none"}).forEach(function(e){var a,s=e.id,o=i.form.query(s).get("display");if(o!=="none"&&((a=e.attribute)===null||a===void 0?void 0:a.display)!=="hidden"){var f=i.form.query(s).take();f&&(f.setDecoratorProps((0,V.Z)((0,V.Z)({},f.decoratorProps),{},{seqNo:n})),n++);var v=1;if(e.type==="QuestionSet"){var m;(m=e.children)===null||m===void 0||m.filter(function(p){return!(0,O.nj)(p.type)}).forEach(function(p){var h=p.id,g=i.form.query(h).get("display");if(g==="visible"){var c=i.form.query(h).take();c&&(c.setDecoratorProps((0,V.Z)((0,V.Z)({},c.decoratorProps),{},{seqNo:v})),v++)}})}}})}},{key:"submit",value:function(){var t=(0,A.Z)((0,P.Z)().mark(function i(){var n,e,a,s,o,f,v,m,p,h,g;return(0,P.Z)().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:n="",e=this.form.query("*").map().filter(function(b){return!(0,j.JF)(b)}),a=(0,k.Z)(e),d.prev=3,a.s();case 5:if((s=a.n()).done){d.next=31;break}if(m=s.value,!(0,j.JF)(m)){d.next=9;break}return d.abrupt("continue",29);case 9:if(n=m.path.toString(),p=((o=this.props.schema.children)===null||o===void 0||(f=o.find(function(b){return b.id===n}))===null||f===void 0||(v=f.attribute)===null||v===void 0?void 0:v.display)==="hidden",!p){d.next=13;break}return d.abrupt("continue",29);case 13:if(h=m.display,h!=="none"){d.next=16;break}return d.abrupt("continue",29);case 16:return g=m.selfDisplay,m.display="visible",d.prev=18,d.next=21,m.validate();case 21:m.display=g,d.next=29;break;case 24:return d.prev=24,d.t0=d.catch(18),this.changePageIndex(n),(0,O.lA)(n,this.props.progressBar?-25:0),d.abrupt("return");case 29:d.next=5;break;case 31:d.next=36;break;case 33:d.prev=33,d.t1=d.catch(3),a.e(d.t1);case 36:return d.prev=36,a.f(),d.finish(36);case 39:return this.props.onSubmit&&this.props.onSubmit((0,y.ZN)(this.form.values)),d.abrupt("return",{values:(0,y.ZN)(this.form.values)});case 41:case"end":return d.stop()}},i,this,[[3,33,36,39],[18,24]])}));function r(){return t.apply(this,arguments)}return r}()},{key:"markQuestion",value:function(r){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,n=this.answerSheet,e=n.findIndex(function(a){return a.id===r});this.answerSheet.splice(e,1,(0,V.Z)((0,V.Z)({},n[e]),{},{marked:i}))}},{key:"favoriteQuestion",value:function(r){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,e=this.answerSheet,a=e.findIndex(function(s){return s.id===r.templateId});n?_.hi.createUserBook((0,V.Z)((0,V.Z)({},r),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},e[a]),{},{favorite:n}))}):_.hi.deleteUserBook((0,V.Z)((0,V.Z)({},r),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},e[a]),{},{favorite:n}))})}},{key:"cleanup",value:function(){this.unmount=!0}}]),l}();function fe(l,t,r){var i=void 0,n=void 0;return function(){var e=+new Date;n||(n=e),r&&e-n>r?(l(),n=e,window.clearTimeout(i)):(window.clearTimeout(i),i=window.setTimeout(function(){l(),n=void 0},t))}}var te=u(99439),ve=u(27484),he=u.n(ve),ce=u(90019),W=u(10192),me=u(76826),ge=u(29371);function pe(l,t){var r,i,n=t.id,e=[];if((r=t.parent)!==null&&r!==void 0&&(i=r.type)!==null&&i!==void 0&&i.startsWith("Matrix"))if(t.parent.type==="MatrixAuto"&&Array.isArray(l))l.forEach(function(f,v){e.push(["".concat(v,"-").concat(n),f[t.id]])});else{var a;(a=t.parent.row)===null||a===void 0||a.forEach(function(f){l[f.id]?e.push(["".concat(f.id,"-").concat(n),l[f.id][t.id]]):e.push(["".concat(f.id,"-").concat(n),void 0])})}else{var s,o=(s=t.parent)===null||s===void 0?void 0:s.type;o==="Radio"||o==="Checkbox"?Object.keys(l).includes(t.id)&&e.push([t.id,l[t.id]]):e.push([t.id,l[t.id]])}return e}function ie(l){return!isNaN(parseFloat(l))&&isFinite(l)}function ye(l){return!!(ie(l)&&Number.isInteger(parseFloat(l)))}function N(l){var t=l.errMsg,r=l.schema,i=l.regEx,n=l.value;return r?S({schema:r,value:n,errMsg:t,isValid:function(a){return a?i.test("".concat(a)):!0}}):null}function be(l){var t,r=l.schema,i=l.value,n=l.errMsg,e=((t=r.children)===null||t===void 0?void 0:t.filter(function(f){var v;return(v=f.attribute)===null||v===void 0?void 0:v.exclusiveFillBlankInMatrix}))||[],a=JSON.parse(JSON.stringify(i));Object.values(a).forEach(function(f){e.map(function(v){return v.id}).forEach(function(v){delete f[v]})});var s=!1;if(r.type==="MatrixAuto")i&&i.length>0&&(s=!0);else{var o;s=(o=r.row)===null||o===void 0?void 0:o.every(function(f){var v=a[f.id];return!(0,O.xb)(v)})}return s?null:n}function S(l){var t=l.value,r=l.schema,i=l.isValid,n=l.errMsg;return!r||!r.parent?null:pe(t,r).map(function(e){var a=(0,ee.Z)(e,2),s=a[0],o=a[1];return i(o)?null:"".concat(s,"^").concat(n)}).filter(function(e){return e})[0]}function Se(l){if(Object.keys(l).length===0)return!0}function Ve(l){var t=l.substring(6,8),r=l.substring(8,10),i=l.substring(10,12),n=new Date(parseFloat(t),parseFloat(r)-1,parseFloat(i));return!(n.getFullYear()-1900!==parseFloat(t)||n.getMonth()!==parseFloat(r)-1||n.getDate()!==parseFloat(i))}function xe(l){var t=l;if(l.length!==15&&l.length!==18)return!1;if(l.length===15)return Ve(t);var r={11:"\u5317\u4EAC",12:"\u5929\u6D25",13:"\u6CB3\u5317",14:"\u5C71\u897F",15:"\u5185\u8499\u53E4",21:"\u8FBD\u5B81",22:"\u5409\u6797",23:"\u9ED1\u9F99\u6C5F ",31:"\u4E0A\u6D77",32:"\u6C5F\u82CF",33:"\u6D59\u6C5F",34:"\u5B89\u5FBD",35:"\u798F\u5EFA",36:"\u6C5F\u897F",37:"\u5C71\u4E1C",41:"\u6CB3\u5357",42:"\u6E56\u5317 ",43:"\u6E56\u5357",44:"\u5E7F\u4E1C",45:"\u5E7F\u897F",46:"\u6D77\u5357",50:"\u91CD\u5E86",51:"\u56DB\u5DDD",52:"\u8D35\u5DDE",53:"\u4E91\u5357",54:"\u897F\u85CF ",61:"\u9655\u897F",62:"\u7518\u8083",63:"\u9752\u6D77",64:"\u5B81\u590F",65:"\u65B0\u7586",71:"\u53F0\u6E7E",81:"\u9999\u6E2F",82:"\u6FB3\u95E8",91:"\u56FD\u5916 "},i=!0;if(!t||!/^([1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx])|([1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2})$/i.test(t))i=!1;else if(!r[t.substr(0,2)])i=!1;else if(t.length>18)i=!1;else if(t.length===18){for(var n=t.split(""),e=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=[1,0,"X",9,8,7,6,5,4,3,2],s=0,o=0,f=0,v=0;v<17;v+=1)o=parseInt(n[v],10),f=e[v],s+=o*f;var m=n[17].toUpperCase()==="X"?"X":Number(n[17]);a[s%11]!==m&&(i=!1)}return i}function E(l,t){var r,i,n;return!l||!t?!0:((r=t.parent)===null||r===void 0?void 0:r.type)==="MatrixAuto"?l.every(function(e){return(0,O.xb)(e[t.id])}):(i=t.parent)!==null&&i!==void 0&&(n=i.type)!==null&&n!==void 0&&n.startsWith("Matrix")?Object.values(l).every(function(e){return(0,O.xb)(e[t.id])}):!!(0,O.xb)(l[t.id])}var Me={required:function(t,r){var i,n,e=r.schema,a=r.theme,s=r.survey;if(r&&r.required===!1)return null;if((0,O.xb)(t)){var o;return a==="antdForm"?"\u8BF7\u8F93\u5165":(s==null||(o=s.attribute)===null||o===void 0?void 0:o.validateMsgQuestionRequired)||"\u8FD9\u9053\u9898\u672A\u56DE\u7B54"}return e!=null&&(i=e.type)!==null&&i!==void 0&&i.startsWith("Matrix")?be({schema:e,errMsg:"\u95EE\u9898\u672A\u56DE\u7B54\u5B8C\u6574",value:t}):e!=null&&e.parent?S({schema:e,value:t,errMsg:(s==null||(n=s.attribute)===null||n===void 0?void 0:n.validateMsgOptionRequired)||"\u8FD9\u4E2A\u9009\u9879\u672A\u56DE\u7B54",isValid:function(v){var m,p,h,g,c,d;return(e==null||(m=e.parent)===null||m===void 0?void 0:m.type)==="MatrixAuto"?!(!(0,ge.H1)(t)&&(0,O.xb)(t[e.id])):e!=null&&(p=e.parent)!==null&&p!==void 0&&(h=p.type)!==null&&h!==void 0&&h.startsWith("Matrix")&&e!==null&&e!==void 0&&(g=e.attribute)!==null&&g!==void 0&&g.dataType?typeof v!="boolean":(0,me.Kn)(e)&&e!==null&&e!==void 0&&(c=e.attribute)!==null&&c!==void 0&&c.dataType&&(e==null||(d=e.attribute)===null||d===void 0?void 0:d.dataType)!=="select"&&t[e.id]===!0?!1:!(0,O.xb)(v)}}):null},text:function(t,r){var i,n,e,a=r.schema;if(E(t,a))return null;var s=(i=r.schema)===null||i===void 0||(n=i.attribute)===null||n===void 0?void 0:n.regexp;return s==null||(e=s.map(function(o){return S({errMsg:o.message,schema:a,value:t,isValid:function(v){return v!==void 0&&typeof v=="string"?new RegExp(o.expression).test(v):!0}})}).filter(function(o){return!!o}))===null||e===void 0?void 0:e[0]},answerLimit:function(t,r){var i,n=r.schema,e=n==null||(i=n.attribute)===null||i===void 0?void 0:i.answerLimit;if(!e)return null;var a=e.slice(1,e.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0"),f=Object.keys(t||{}).length;return t&&(f<s&&s!==0||f>o&&o!==0)?s===0?"\u6700\u591A\u9009\u62E9".concat(o,"\u9879"):o===0?"\u6700\u5C11\u9009\u62E9".concat(s,"\u9879"):"\u6700\u5C11\u9009\u62E9".concat(s,"\u9879,\u6700\u591A\u9009\u62E9").concat(o,"\u9879"):null},number:function(t,r){var i,n=r.schema;if(E(t,n))return null;var e=n==null||(i=n.attribute)===null||i===void 0?void 0:i.numericScale,a="\u8BF7\u8F93\u5165\u6570\u5B57";return e===0?a="\u8BF7\u8F93\u5165\u6574\u6570":e&&e>0&&(a="\u8BF7\u4FDD\u7559".concat(e,"\u4F4D\u5C0F\u6570")),S({errMsg:a,schema:n,value:t,isValid:function(o){return!(o!==void 0&&(!ie(o)||e===0&&!ye(o)||e!==void 0&&e>0&&("".concat(o).split(".")[1]||"").length>e))}})},date:function(t,r){var i,n=r.schema;if(E(t,n))return null;if(n!=null&&(i=n.attribute)!==null&&i!==void 0&&i.dateTimeFormat&&t&&t[n.id]){var e=he()(t[n.id],n.attribute.dateTimeFormat).isValid();return e?null:"\u65E5\u671F\u683C\u5F0F\u4E0D\u6B63\u786E"}return N({errMsg:"\u8BF7\u8F93\u5165\u65E5\u671F",schema:n,regEx:/^(?:(?:1[6-9]|[2-9][0-9])[0-9]{2}([-/.]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:(?:1[6-9]|[2-9][0-9])(?:0[48]|[2468][048]|[13579][26])|(?:16|[2468][048]|[3579][26])00)([-/.]?)0?2\2(?:29))(\s+([01][0-9]:|2[0-3]:)?[0-5][0-9]:[0-5][0-9])?$/,value:t})},dateTime:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u8BF7\u8F93\u5165\u65E5\u671F\u65F6\u95F4",schema:i,regEx:/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))\s(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:t})},time:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u8BF7\u8F93\u5165\u65F6\u95F4",schema:i,regEx:/^(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:t})},mobile:function(t,r){var i=r.schema;return E(t,i)||t[i.id]===!0?null:N({errMsg:"\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,regEx:/^1[0-9]{10}$/,value:t})},decimal:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u8BF7\u8F93\u5165\u6570\u5B57",schema:i,regEx:/^[+-]?\d+(\.\d+)?$/,value:t})},email:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u90AE\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,regEx:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,value:t})},idCard:function(t,r){var i=r.schema;return E(t,i)?null:S({errMsg:"\u8EAB\u4EFD\u8BC1\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,value:t,isValid:function(e){return!(e&&!xe("".concat(e)))}})},chinese:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u8BF7\u8F93\u5165\u6C49\u5B57",schema:i,regEx:/^[\u4e00-\u9fa5]+$/,value:t})},alphabet:function(t,r){var i=r.schema;return E(t,i)?null:N({errMsg:"\u8BF7\u8F93\u5165\u5B57\u6BCD",schema:i,regEx:/^[a-zA-Z]+$/,value:t})},textLimit:function(t,r){var i,n=r.schema;if(E(t,n))return null;var e=n==null||(i=n.attribute)===null||i===void 0?void 0:i.textLimit;if(!e)return null;var a=e.slice(1,e.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0");if(s===0&&o===0)return null;var f=S({errMsg:s!==o?"\u8BF7\u8F93\u5165".concat(s,"~").concat(o,"\u4E2A\u5B57"):"\u8BF7\u8F93\u5165".concat(s,"\u4E2A\u5B57"),schema:n,value:t,isValid:function(m){return!(m&&("".concat(m).length<s||"".concat(m).length>o))}});return f},scope:function(t,r){var i,n,e,a=r.schema;if(E(t,a))return null;var s=a==null||(i=a.attribute)===null||i===void 0?void 0:i.scope,o=a==null||(n=a.attribute)===null||n===void 0?void 0:n.dataType;if(s&&o){if(o==="number")return S({errMsg:"\u6570\u503C\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:t,isValid:function(d){return!(d!==void 0&&!(0,W.$l)(s,"".concat(d)))}});if(o==="date")return S({errMsg:"\u65E5\u671F\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:t,isValid:function(d){return!(d&&!(0,W.sm)(s,"".concat(d)))}});if(o==="dateTime")return S({errMsg:"\u65E5\u671F\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:t,isValid:function(d){return!(d&&!(0,W.de)(s,"".concat(d)))}});if(o==="time")return S({errMsg:"\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:t,isValid:function(d){return!(d&&!(0,W.YM)(s,"".concat(d)))}})}else if((a==null?void 0:a.type)==="MatrixAuto"&&(e=a.attribute)!==null&&e!==void 0&&e.scope){var f,v=(f=a.attribute)===null||f===void 0?void 0:f.scope,m=(0,W.$l)(v,"".concat(Object.keys(t).length));if(m)return null;var p=v.substring(1,v.indexOf(",")),h=v.substring(v.indexOf(",")+1,v.length-1),g=[];return p&&g.push("\u6700\u5C11".concat(p,"\u884C")),h&&g.push("\u6700\u591A".concat(h,"\u884C")),g.join("\uFF0C")}return null},horzBlank:function(t,r){return(0,A.Z)((0,P.Z)().mark(function i(){var n,e,a,s,o,f,v,m;return(0,P.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:if(e=r.schema,t){h.next=3;break}return h.abrupt("return",null);case 3:if(!((e==null||(n=e.attribute)===null||n===void 0?void 0:n.dataType)!=="horzBlank"||t[e.id]===void 0||!e.children||!e.parent)){h.next=5;break}return h.abrupt("return",null);case 5:a=null,s=0;case 7:if(!(s<((o=e.children)===null||o===void 0?void 0:o.length))){h.next=17;break}return f=e.children[s],v=(0,ce.j)(f,e),h.next=12,(0,te.Gu)(t[e.id],v,{validateFirst:!0});case 12:m=h.sent,m.error&&m.error.length>0&&(a=m.error[0]);case 14:s++,h.next=7;break;case 17:return h.abrupt("return",a);case 18:case"end":return h.stop()}},i)}))()}};(0,te.au)(Me);var Oe=u(8166),ne=u(8373),L=u(85893);window.katex=Oe.Z;var re=(0,M.forwardRef)(function(l,t){var r=l.theme,i=r===void 0?Y.uH:r,n=l.footerVisible,e=n===void 0?!0:n,a=l.headerVisible,s=a===void 0?!0:a,o=l.loading,f=l.questionNumber,v=f===void 0?!0:f,m=l.onUpload,p=l.progressBar,h=p===void 0?!1:p,g=l.statistics,c=l.isPreview,d=l.mode,b=d===void 0?"survey":d,$=l.correctAnswerVisible,x=$===void 0?!1:$,Z=l.examScoreVisible,F=Z===void 0?!1:Z,z=l.requiredVisible,B=z===void 0?!0:z,J=l.onDictSearch,Pe=l.onLink,Ze=l.triggerType,H=(0,M.useMemo)(function(){return new de(l)},[]),I=H.form,R=(0,M.useMemo)(function(){return(0,O.Gt)(l.schema)},[l.schema]),Fe=(0,M.useMemo)(function(){var C={},D=function U(w){C[w.id]=w.title,w.children&&w.children.forEach(U)};return D(R),document.title=(0,_.WO)(R.title),C},[R]),Ee=(0,M.useMemo)(function(){return(0,O.R6)(l.schema)},[l.schema]);(0,M.useImperativeHandle)(t,function(){return{submit:function(){return H.submit()},reset:function(){I.reset()},setValues:function(D){I.setValues(D,"overwrite")},setValue:function(D,U){I.setFieldState(D,function(w){return w.value=U})},toggleReadOnly:function(D){I.setState(function(U){U.pattern=D?"readPretty":"editable"})},getValues:function(){return I.values},getStore:function(){return H}}}),(0,M.useEffect)(function(){l.onInit&&l.onInit(I)},[]);var Ae=(0,M.useMemo)(function(){return{theme:i,schema:R,footerVisible:e,questionNumber:v,headerVisible:s,optionTypes:Ee,onUpload:m,loading:o,id2title:Fe,progressBar:h,innerStore:H,statistics:g,isPreview:c,mode:b,correctAnswerVisible:x,examScoreVisible:F,onDictSearch:J,requiredVisible:B,onLink:Pe,triggerType:Ze}},[o,R,g]);return(0,L.jsx)(M.Suspense,{fallback:(0,L.jsx)(ne.gb,{}),children:(0,L.jsx)(ne.ZP,{theme:i,children:(0,L.jsx)(Q.RV,{form:I,children:(0,L.jsx)(K.Z.Provider,{value:Ae,children:(0,L.jsx)(G.k9,{schema:R})})})})})}),$e=re},8373:function(ae,X,u){"use strict";u.d(X,{gb:function(){return k}});var Q=u(67294),M=u(85893),G=Q.lazy(function(){return Promise.all([u.e(2225),u.e(9223),u.e(4968),u.e(7115),u.e(7422),u.e(9278),u.e(701),u.e(3305),u.e(5362),u.e(9228),u.e(4839),u.e(1818),u.e(9454),u.e(3524),u.e(4512),u.e(1476),u.e(780),u.e(1044),u.e(6131),u.e(1702),u.e(1004)]).then(u.bind(u,6465))}),K=Q.lazy(function(){return Promise.all([u.e(2225),u.e(9223),u.e(4968),u.e(7098),u.e(7115),u.e(7422),u.e(9278),u.e(5246),u.e(701),u.e(3305),u.e(9228),u.e(4839),u.e(1818),u.e(5555),u.e(9454),u.e(4512),u.e(780),u.e(7707),u.e(1044),u.e(5761),u.e(8851),u.e(3428)]).then(u.bind(u,61616))}),Y=Q.lazy(function(){return Promise.all([u.e(9223),u.e(7115),u.e(9278),u.e(5246),u.e(5362),u.e(4839),u.e(1044),u.e(6713),u.e(2944)]).then(u.bind(u,17707))}),k=function(){return(0,M.jsx)("div",{className:"page-loading-warp",children:(0,M.jsxs)("div",{className:"spinner",children:[(0,M.jsx)("div",{className:"rect1"}),(0,M.jsx)("div",{className:"rect2"}),(0,M.jsx)("div",{className:"rect3"}),(0,M.jsx)("div",{className:"rect4"}),(0,M.jsx)("div",{className:"rect5"})]})})},q=function(T){var A=T.theme,V=T.children;return A==="antdMobile"?(0,M.jsx)(K,{children:V}):A==="antdForm"?(0,M.jsx)(Y,{children:V}):(0,M.jsx)(G,{children:V})};X.ZP=q}}]);
